#!/usr/bin/env bash

# Determina el directorio del script actual
script_dir=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
dry="0"

# Parseo de argumentos
while [[ $# -gt 0 ]]; do
	case "$1" in
		--dry)
			dry="1"
			;;
	esac
	shift
done

# Función para imprimir logs, diferenciando entre ejecución real y modo dry
log() {
	if [[ "$dry" == "1" ]]; then
		echo "[DRY_RUN]: $*"
	else
		echo "$*"
	fi
}

# Función para ejecutar comandos solo si no está en modo dry
execute() {
	log "execute $*"

	if [[ "$dry" == "1" ]]; then
		return
	fi

	"$@"
}

log "------------------ dev-env ------------------"

# Copia directorios desde $1 hacia $2, eliminando los que ya existan
copy_dir() {
	local from="$1"
	local to="$2"

	pushd "$from" > /dev/null || exit 1
	local dirs
	dirs=$(find . -mindepth 1 -maxdepth 1 -type d)

	for dir in $dirs; do
		execute rm -rf "$to/$dir"
		execute cp -r "$dir" "$to/$dir"
	done

	popd > /dev/null || exit 1
}

# Copia un archivo desde $1 hacia $2, reemplazándolo si ya existe
copy_file() {
	local from="$1"
	local to="$2"
	local name
	name=$(basename "$from")

	execute rm -f "$to/$name"
	execute cp "$from" "$to/$name"
}

# Ejecuta las copias
copy_dir "$script_dir/.config" "${XDG_CONFIG_HOME:-$HOME/.config}"
copy_dir "$script_dir/.local" "$HOME/.local"
copy_file "$script_dir/.ready-tmux" "$HOME"
copy_file "$script_dir/.zshrc" "$HOME"

